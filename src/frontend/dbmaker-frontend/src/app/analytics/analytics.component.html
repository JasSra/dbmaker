<div class="analytics-container">
  <!-- Header -->
  <div class="analytics-header">
    <h1>StarkLink Analytics</h1>
    <p>Real-time container monitoring and system insights</p>
  </div>

  <!-- System Overview Cards -->
  <div class="overview-grid">
    <mat-card class="overview-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>storage</mat-icon>
          <h3>Total Containers</h3>
        </div>
        <div class="metric-value">{{ systemStats.totalContainers }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="overview-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>play_circle_filled</mat-icon>
          <h3>Running</h3>
        </div>
        <div class="metric-value">{{ systemStats.runningContainers }}</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="overview-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>memory</mat-icon>
          <h3>CPU Usage</h3>
        </div>
        <div class="metric-value">{{ systemStats.cpuUsage | number:'1.1-1' }}%</div>
        <mat-progress-bar
          [value]="systemStats.cpuUsage"
          [color]="getUsageColor(systemStats.cpuUsage)"
          mode="determinate">
        </mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <mat-card class="overview-card">
      <mat-card-content>
        <div class="card-header">
          <mat-icon>memory</mat-icon>
          <h3>Memory Usage</h3>
        </div>
        <div class="metric-value">{{ systemStats.memoryUsage | number:'1.1-1' }}%</div>
        <mat-progress-bar
          [value]="systemStats.memoryUsage"
          [color]="getUsageColor(systemStats.memoryUsage)"
          mode="determinate">
        </mat-progress-bar>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Tabs for different views -->
  <mat-tab-group class="analytics-tabs">
    <!-- Container Metrics Tab -->
    <mat-tab label="Container Metrics">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Container Performance Metrics</mat-card-title>
            <mat-card-subtitle>Real-time performance data for all containers</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="loading-container" *ngIf="loadingMetrics">
              <mat-progress-spinner diameter="50" mode="indeterminate"></mat-progress-spinner>
              <p>Loading container metrics...</p>
            </div>

            <table mat-table [dataSource]="containerMetrics" class="metrics-table" *ngIf="!loadingMetrics">
              <!-- Container Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Container</th>
                <td mat-cell *matCellDef="let metric">
                  <div class="container-name">
                    <mat-chip [color]="getStatusColor('running')">{{ metric.name }}</mat-chip>
                  </div>
                </td>
              </ng-container>

              <!-- CPU Column -->
              <ng-container matColumnDef="cpu">
                <th mat-header-cell *matHeaderCellDef>CPU Usage</th>
                <td mat-cell *matCellDef="let metric">
                  <div class="metric-cell">
                    <span>{{ metric.cpuPercent | number:'1.1-1' }}%</span>
                    <mat-progress-bar
                      [value]="metric.cpuPercent"
                      [color]="getUsageColor(metric.cpuPercent)"
                      mode="determinate">
                    </mat-progress-bar>
                  </div>
                </td>
              </ng-container>

              <!-- Memory Column -->
              <ng-container matColumnDef="memory">
                <th mat-header-cell *matHeaderCellDef>Memory Usage</th>
                <td mat-cell *matCellDef="let metric">
                  <div class="metric-cell">
                    <span>{{ formatBytes(metric.memoryUsage) }} / {{ formatBytes(metric.memoryLimit) }}</span>
                    <mat-progress-bar
                      [value]="metric.memoryPercent"
                      [color]="getUsageColor(metric.memoryPercent)"
                      mode="determinate">
                    </mat-progress-bar>
                  </div>
                </td>
              </ng-container>

              <!-- Network Column -->
              <ng-container matColumnDef="network">
                <th mat-header-cell *matHeaderCellDef>Network I/O</th>
                <td mat-cell *matCellDef="let metric">
                  <div class="network-metrics">
                    <span class="network-in">↓ {{ formatBytes(metric.networkIn) }}/s</span>
                    <span class="network-out">↑ {{ formatBytes(metric.networkOut) }}/s</span>
                  </div>
                </td>
              </ng-container>

              <!-- Uptime Column -->
              <ng-container matColumnDef="uptime">
                <th mat-header-cell *matHeaderCellDef>Uptime</th>
                <td mat-cell *matCellDef="let metric">
                  {{ formatUptime(metric.uptime) }}
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let metric">
                  <button mat-icon-button
                          (click)="selectContainerByMetric(metric)"
                          matTooltip="View Logs">
                    <mat-icon>visibility</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Container Logs Tab -->
    <mat-tab label="Container Logs">
      <div class="tab-content">
        <div class="logs-section">
          <!-- Container Selection -->
          <mat-card class="container-selector">
            <mat-card-content>
              <h3>Select Container to View Logs</h3>
              <div class="container-chips">
                <mat-chip-option
                  *ngFor="let container of containers"
                  [selected]="selectedContainer && selectedContainer.id === container.id"
                  (click)="selectContainer(container)"
                  [color]="getStatusColor((container.status || '').toString())">
                  <mat-icon>{{ ((container.status || '').toString().toLowerCase() === 'running') ? 'play_circle_filled' : 'stop_circle' }}</mat-icon>
                  {{ container.name }}
                </mat-chip-option>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Logs Display -->
          <mat-card class="logs-display" *ngIf="selectedContainer">
            <mat-card-header>
              <mat-card-title>{{ selectedContainer.name }} Logs</mat-card-title>
              <mat-card-subtitle>Real-time container logs</mat-card-subtitle>
            </mat-card-header>
            <mat-card-content>
              <div class="loading-container" *ngIf="loadingLogs">
                <mat-progress-spinner diameter="30" mode="indeterminate"></mat-progress-spinner>
                <p>Loading logs...</p>
              </div>

              <div class="logs-content" *ngIf="!loadingLogs">
                <div class="log-entry" *ngFor="let log of containerLogs">{{ log }}</div>
              </div>

              <div class="logs-actions">
                <button mat-raised-button color="primary" (click)="loadContainerLogs(selectedContainer.id || '')">
                  <mat-icon>refresh</mat-icon>
                  Refresh Logs
                </button>
                <button mat-button>
                  <mat-icon>download</mat-icon>
                  Download Logs
                </button>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- System Monitoring Tab -->
    <mat-tab label="System Monitoring">
      <div class="tab-content">
        <div class="monitoring-grid">
          <!-- CPU Chart -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>CPU Usage Over Time</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-placeholder">
                <mat-icon>trending_up</mat-icon>
                <p>CPU usage: {{ systemStats.cpuUsage | number:'1.1-1' }}%</p>
                <div class="mini-chart">
                  <span *ngFor="let value of cpuChartData"
                        class="chart-bar"
                        [style.height.%]="value">
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Memory Chart -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Memory Usage Over Time</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-placeholder">
                <mat-icon>memory</mat-icon>
                <p>Memory usage: {{ systemStats.memoryUsage | number:'1.1-1' }}%</p>
                <div class="mini-chart">
                  <span *ngFor="let value of memoryChartData"
                        class="chart-bar"
                        [style.height.%]="value">
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Network Chart -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Network I/O</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-placeholder">
                <mat-icon>network_check</mat-icon>
                <p>In: {{ formatBytes(systemStats.networkIn) }}/s</p>
                <p>Out: {{ formatBytes(systemStats.networkOut) }}/s</p>
              </div>
            </mat-card-content>
          </mat-card>

          <!-- Disk Usage -->
          <mat-card class="chart-card">
            <mat-card-header>
              <mat-card-title>Disk Usage</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="chart-placeholder">
                <mat-icon>storage</mat-icon>
                <p>Disk usage: {{ systemStats.diskUsage | number:'1.1-1' }}%</p>
                <mat-progress-bar
                  [value]="systemStats.diskUsage"
                  [color]="getUsageColor(systemStats.diskUsage)"
                  mode="determinate">
                </mat-progress-bar>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Docker Information Tab -->
    <mat-tab label="Docker Info">
      <div class="tab-content">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Docker Engine Information</mat-card-title>
            <mat-card-subtitle>System and Docker daemon details</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div class="expansion-panel-group">
              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>System Information</mat-panel-title>
                </mat-expansion-panel-header>
                <div class="info-grid">
                  <div class="info-item">
                    <strong>Operating System:</strong>
                    <span>Windows 11 Enterprise</span>
                  </div>
                  <div class="info-item">
                    <strong>Docker Version:</strong>
                    <span>24.0.7</span>
                  </div>
                  <div class="info-item">
                    <strong>API Version:</strong>
                    <span>1.43</span>
                  </div>
                  <div class="info-item">
                    <strong>Architecture:</strong>
                    <span>x86_64</span>
                  </div>
                </div>
              </mat-expansion-panel>

              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>Resource Limits</mat-panel-title>
                </mat-expansion-panel-header>
                <div class="info-grid">
                  <div class="info-item">
                    <strong>Total Memory:</strong>
                    <span>16 GB</span>
                  </div>
                  <div class="info-item">
                    <strong>Available Memory:</strong>
                    <span>12 GB</span>
                  </div>
                  <div class="info-item">
                    <strong>CPU Cores:</strong>
                    <span>8</span>
                  </div>
                  <div class="info-item">
                    <strong>Docker Root Dir:</strong>
                    <span>C:\ProgramData\Docker</span>
                  </div>
                </div>
              </mat-expansion-panel>

              <mat-expansion-panel>
                <mat-expansion-panel-header>
                  <mat-panel-title>Network Configuration</mat-panel-title>
                </mat-expansion-panel-header>
                <div class="info-grid">
                  <div class="info-item">
                    <strong>Bridge Network:</strong>
                    <span>172.17.0.1/16</span>
                  </div>
                  <div class="info-item">
                    <strong>NAT Network:</strong>
                    <span>10.0.75.0/24</span>
                  </div>
                  <div class="info-item">
                    <strong>Host Network:</strong>
                    <span>Enabled</span>
                  </div>
                </div>
              </mat-expansion-panel>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
